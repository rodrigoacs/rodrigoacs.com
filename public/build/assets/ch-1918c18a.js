const q=document.getElementById("previousDate"),x=document.getElementById("nextDate"),s=document.getElementById("currentDate"),g=document.getElementById("add");document.getElementById("calculate");const T=document.getElementById("result"),A=document.getElementById("change-theme"),m=document.documentElement,C=document.getElementById("close"),w=document.getElementById("help");let o=new Date,S=0;s.value=l(o);document.addEventListener("DOMContentLoaded",d);g.addEventListener("click",v);setInterval(F,200);setInterval(O,500);s.addEventListener("change",()=>{const[t,e,n]=s.value.split("-");o=new Date(t,e-1,n),f(),d()});function D(t){o.setDate(o.getDate()+t),s.value=l(o)}function l(t){return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function M(t,e){const n=new Date;return t=E(n,t),e=E(n,e),(e-t)/6e4}function E(t,e){const[n,a]=e.split(":");return new Date(t.getFullYear(),t.getMonth(),t.getDate(),n,a).getTime()}function F(){const t=document.querySelectorAll(".interval");let e=0;for(const r of t){const c=r.children[1].value,h=r.children[2].value,$=r.children[4];if(c&&h){const p=M(c,h);e+=p;const y=I(p),k=y[0].toString().padStart(2,"0"),B=y[1].toString().padStart(2,"0");$.value=`${k}:${B}`}}if(e===S)return;S=e;const n=I(e);if(n[0]<0||n[1]<0){g.disabled=!0,T.innerText="horas inválidas";return}else g.disabled=!1;const a=n[0].toString().padStart(2,"0"),u=n[1].toString().padStart(2,"0");T.innerText=`${a}:${u}`}function I(t){const e=parseInt(t/60),n=t-e*60;return[e,n]}function v(){const t=document.querySelector(".inside"),e=document.createElement("div");e.classList.add("interval");const n=i("time"),a=i("time"),u=i("text"),r=i("time",!0),c=document.createElement("button");c.innerText="✖",c.classList.add("delete"),c.addEventListener("click",()=>b()&&e.remove()),e.appendChild(c),e.appendChild(n),e.appendChild(a),e.appendChild(u),e.appendChild(r),t.appendChild(e)}function i(t,e=!1){const n=document.createElement("input");return n.type=t,e&&(n.readOnly=!0),n}function f(){const t=document.querySelectorAll(".interval");for(const e of t)e.remove()}function d(){for(let e=0;e<L();e++)v();const t=document.querySelectorAll(".interval");t.forEach((e,n)=>{const a=JSON.parse(localStorage.getItem(`${n+" "+l(o)}`));a&&(e.children[1].value=a.startTime,e.children[2].value=a.endTime,e.children[3].value=a.description,e.children[4].value=a.totalTime)}),t||v()}function L(){let t=0;for(;localStorage.getItem(`${t+" "+l(o)}`);)t++;return t}function O(){let t=document.querySelectorAll(".interval");t=Array.from(t),t=t.map(e=>({startTime:e.children[1].value,endTime:e.children[2].value,description:e.children[3].value,totalTime:e.children[4].value})).filter(e=>e.startTime&&e.endTime&&e.description&&e.totalTime),t.forEach((e,n)=>{localStorage.setItem(`${n+" "+l(o)}`,JSON.stringify(e))})}function b(){let t=L();for(let e=0;e<t;e++)localStorage.removeItem(`${e+" "+l(o)}`);t--;for(let e=0;e<t;e++)localStorage.setItem(`${e+" "+l(o)}`,localStorage.getItem(`${e+1+" "+l(o)}`));return localStorage.removeItem(`${t+" "+l(o)}`),!0}q.addEventListener("click",()=>{D(-1),f(),d()});x.addEventListener("click",()=>{D(1),f(),d()});C.addEventListener("click",()=>{document.querySelector(".modal").style.display="none"});w.addEventListener("click",()=>{document.querySelector(".modal").style.display="flex"});A.addEventListener("click",H);function H(){m.classList.contains("light-mode")?m.classList.remove("light-mode"):m.classList.add("light-mode")}
