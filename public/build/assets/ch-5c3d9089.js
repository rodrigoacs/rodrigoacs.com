const q=document.getElementById("previousDate"),x=document.getElementById("nextDate"),s=document.getElementById("currentDate"),g=document.getElementById("add");document.getElementById("calculate");const S=document.getElementById("result"),A=document.getElementById("change-theme"),m=document.documentElement,C=document.getElementById("close"),w=document.getElementById("help");let o=new Date,T=0;s.value=a(o);document.addEventListener("DOMContentLoaded",()=>{d(),localStorage.getItem("help")==="false"?document.querySelector(".modal").style.display="none":document.querySelector(".modal").style.display="flex"});g.addEventListener("click",f);setInterval(F,200);setInterval(O,500);s.addEventListener("change",()=>{const[t,e,n]=s.value.split("-");o=new Date(t,e-1,n),v(),d()});function D(t){o.setDate(o.getDate()+t),s.value=a(o)}function a(t){return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function M(t,e){const n=new Date;return t=I(n,t),e=I(n,e),(e-t)/6e4}function I(t,e){const[n,l]=e.split(":");return new Date(t.getFullYear(),t.getMonth(),t.getDate(),n,l).getTime()}function F(){const t=document.querySelectorAll(".interval");let e=0;for(const r of t){const c=r.children[1].value,h=r.children[2].value,$=r.children[4];if(c&&h){const p=M(c,h);e+=p;const y=E(p),k=y[0].toString().padStart(2,"0"),B=y[1].toString().padStart(2,"0");$.value=`${k}:${B}`}}if(e===T)return;T=e;const n=E(e);if(n[0]<0||n[1]<0){g.disabled=!0,S.innerText="horas inválidas";return}else g.disabled=!1;const l=n[0].toString().padStart(2,"0"),u=n[1].toString().padStart(2,"0");S.innerText=`${l}:${u}`}function E(t){const e=parseInt(t/60),n=t-e*60;return[e,n]}function f(){const t=document.querySelector(".inside"),e=document.createElement("div");e.classList.add("interval");const n=i("time"),l=i("time"),u=i("text"),r=i("time",!0),c=document.createElement("button");c.innerText="✖",c.classList.add("delete"),c.addEventListener("click",()=>b()&&e.remove()),e.appendChild(c),e.appendChild(n),e.appendChild(l),e.appendChild(u),e.appendChild(r),t.appendChild(e)}function i(t,e=!1){const n=document.createElement("input");return n.type=t,e&&(n.readOnly=!0),n}function v(){const t=document.querySelectorAll(".interval");for(const e of t)e.remove()}function d(){for(let e=0;e<L();e++)f();const t=document.querySelectorAll(".interval");t.forEach((e,n)=>{const l=JSON.parse(localStorage.getItem(`${n+" "+a(o)}`));l&&(e.children[1].value=l.startTime,e.children[2].value=l.endTime,e.children[3].value=l.description,e.children[4].value=l.totalTime)}),t||f()}function L(){let t=0;for(;localStorage.getItem(`${t+" "+a(o)}`);)t++;return t}function O(){let t=document.querySelectorAll(".interval");t=Array.from(t),t=t.map(e=>({startTime:e.children[1].value,endTime:e.children[2].value,description:e.children[3].value,totalTime:e.children[4].value})).filter(e=>e.startTime&&e.endTime&&e.description&&e.totalTime),t.forEach((e,n)=>{localStorage.setItem(`${n+" "+a(o)}`,JSON.stringify(e))})}function b(){let t=L();for(let e=0;e<t;e++)localStorage.removeItem(`${e+" "+a(o)}`);t--;for(let e=0;e<t;e++)localStorage.setItem(`${e+" "+a(o)}`,localStorage.getItem(`${e+1+" "+a(o)}`));return localStorage.removeItem(`${t+" "+a(o)}`),!0}q.addEventListener("click",()=>{D(-1),v(),d()});x.addEventListener("click",()=>{D(1),v(),d()});C.addEventListener("click",()=>{document.querySelector(".modal").style.display="none",localStorage.setItem("help",!1)});w.addEventListener("click",()=>{document.querySelector(".modal").style.display="flex"});A.addEventListener("click",H);function H(){m.classList.contains("light-mode")?m.classList.remove("light-mode"):m.classList.add("light-mode")}
