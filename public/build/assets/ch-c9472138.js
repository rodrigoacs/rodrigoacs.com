const q=document.getElementById("previousDate"),x=document.getElementById("nextDate"),s=document.getElementById("currentDate"),g=document.getElementById("add");document.getElementById("calculate");const S=document.getElementById("result"),A=document.getElementById("change-theme"),m=document.documentElement,C=document.getElementById("close"),w=document.getElementById("help");let l=new Date,T=0;s.value=a(l);document.addEventListener("DOMContentLoaded",()=>{d(),localStorage.getItem("help")==="false"?document.querySelector(".modal").style.display="none":document.querySelector(".modal").style.display="flex"});g.addEventListener("click",f);setInterval(F,200);setInterval(O,500);s.addEventListener("change",()=>{const[t,e,n]=s.value.split("-");l=new Date(t,e-1,n),v(),d()});function D(t){l.setDate(l.getDate()+t),s.value=a(l),console.log(a(l))}function a(t){const e=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${e}-${n}-${o}`}function M(t,e){const n=new Date;return t=I(n,t),e=I(n,e),(e-t)/6e4}function I(t,e){const[n,o]=e.split(":");return new Date(t.getFullYear(),t.getMonth(),t.getDate(),n,o).getTime()}function F(){const t=document.querySelectorAll(".interval");let e=0;for(const c of t){const r=c.children[1].value,p=c.children[2].value,$=c.children[4];if(r&&p){const h=M(r,p);e+=h;const y=E(h),k=y[0].toString().padStart(2,"0"),B=y[1].toString().padStart(2,"0");$.value=`${k}:${B}`}}if(e===T)return;T=e;const n=E(e);if(n[0]<0||n[1]<0){g.disabled=!0,S.innerText="horas inválidas";return}else g.disabled=!1;const o=n[0].toString().padStart(2,"0"),u=n[1].toString().padStart(2,"0");S.innerText=`${o}:${u}`}function E(t){const e=parseInt(t/60),n=t-e*60;return[e,n]}function f(){const t=document.querySelector(".inside"),e=document.createElement("div");e.classList.add("interval");const n=i("time"),o=i("time"),u=i("text"),c=i("time",!0),r=document.createElement("button");r.innerText="✖",r.classList.add("delete"),r.addEventListener("click",()=>b()&&e.remove()),e.appendChild(r),e.appendChild(n),e.appendChild(o),e.appendChild(u),e.appendChild(c),t.appendChild(e)}function i(t,e=!1){const n=document.createElement("input");return n.type=t,e&&(n.readOnly=!0),n}function v(){const t=document.querySelectorAll(".interval");for(const e of t)e.remove()}function d(){for(let e=0;e<L();e++)f();const t=document.querySelectorAll(".interval");t.forEach((e,n)=>{const o=JSON.parse(localStorage.getItem(`${n+" "+a(l)}`));o&&(e.children[1].value=o.startTime,e.children[2].value=o.endTime,e.children[3].value=o.description,e.children[4].value=o.totalTime)}),t||f()}function L(){let t=0;for(;localStorage.getItem(`${t+" "+a(l)}`);)t++;return t}function O(){let t=document.querySelectorAll(".interval");t=Array.from(t),t=t.map(e=>({startTime:e.children[1].value,endTime:e.children[2].value,description:e.children[3].value,totalTime:e.children[4].value})).filter(e=>e.startTime&&e.endTime&&e.description&&e.totalTime),t.forEach((e,n)=>{localStorage.setItem(`${n+" "+a(l)}`,JSON.stringify(e))})}function b(){let t=L();for(let e=0;e<t;e++)localStorage.removeItem(`${e+" "+a(l)}`);t--;for(let e=0;e<t;e++)localStorage.setItem(`${e+" "+a(l)}`,localStorage.getItem(`${e+1+" "+a(l)}`));return localStorage.removeItem(`${t+" "+a(l)}`),!0}q.addEventListener("click",()=>{D(-1),v(),d()});x.addEventListener("click",()=>{D(1),v(),d()});C.addEventListener("click",()=>{document.querySelector(".modal").style.display="none",localStorage.setItem("help",!1)});w.addEventListener("click",()=>{document.querySelector(".modal").style.display="flex"});A.addEventListener("click",H);function H(){m.classList.contains("light-mode")?m.classList.remove("light-mode"):m.classList.add("light-mode")}
