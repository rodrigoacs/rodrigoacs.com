const A=document.getElementById("previousDate"),C=document.getElementById("nextDate"),s=document.getElementById("currentDate"),g=document.getElementById("add");document.getElementById("calculate");const T=document.getElementById("result"),q=document.getElementById("change-theme"),m=document.documentElement;let o=new Date,S=0;s.value=r(o);document.addEventListener("DOMContentLoaded",d);g.addEventListener("click",D);setInterval(w,200);setInterval(M,500);s.addEventListener("change",()=>{const[t,e,n]=s.value.split("-");o=new Date(t,e-1,n),v(),d()});function E(t){o.setDate(o.getDate()+t),s.value=r(o)}function r(t){return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}function x(t,e){const n=new Date;return t=y(n,t),e=y(n,e),(e-t)/6e4}function y(t,e){const[n,a]=e.split(":");return new Date(t.getFullYear(),t.getMonth(),t.getDate(),n,a).getTime()}function w(){const t=document.querySelectorAll(".interval");let e=0;for(const c of t){const l=c.children[1].value,f=c.children[2].value,$=c.children[4];if(l&&f){const h=x(l,f);e+=h;const p=I(h),k=p[0].toString().padStart(2,"0"),B=p[1].toString().padStart(2,"0");$.value=`${k}:${B}`}}if(e===S)return;S=e;const n=I(e);if(n[0]<0||n[1]<0){g.disabled=!0,T.innerText="horas inválidas";return}else g.disabled=!1;const a=n[0].toString().padStart(2,"0"),u=n[1].toString().padStart(2,"0");T.innerText=`${a}:${u}`}function I(t){const e=parseInt(t/60),n=t-e*60;return[e,n]}function D(){const t=document.querySelector(".inside"),e=document.createElement("div");e.classList.add("interval");const n=i("time"),a=i("time"),u=i("text"),c=i("time",!0),l=document.createElement("button");l.innerText="✖",l.classList.add("delete"),l.addEventListener("click",()=>F()&&e.remove()),e.appendChild(l),e.appendChild(n),e.appendChild(a),e.appendChild(u),e.appendChild(c),t.appendChild(e)}function i(t,e=!1){const n=document.createElement("input");return n.type=t,e&&(n.readOnly=!0),n}function v(){const t=document.querySelectorAll(".interval");for(const e of t)e.remove()}function d(){for(let e=0;e<L();e++)D();document.querySelectorAll(".interval").forEach((e,n)=>{const a=JSON.parse(localStorage.getItem(`${n+" "+r(o)}`));a&&(e.children[1].value=a.startTime,e.children[2].value=a.endTime,e.children[3].value=a.description,e.children[4].value=a.totalTime)})}function L(){let t=0;for(;localStorage.getItem(`${t+" "+r(o)}`);)t++;return t}function M(){let t=document.querySelectorAll(".interval");t=Array.from(t),t=t.map(e=>({startTime:e.children[1].value,endTime:e.children[2].value,description:e.children[3].value,totalTime:e.children[4].value})).filter(e=>e.startTime&&e.endTime&&e.description&&e.totalTime),t.forEach((e,n)=>{localStorage.setItem(`${n+" "+r(o)}`,JSON.stringify(e))})}function F(){let t=L();for(let e=0;e<t;e++)localStorage.removeItem(`${e+" "+r(o)}`);t--;for(let e=0;e<t;e++)localStorage.setItem(`${e+" "+r(o)}`,localStorage.getItem(`${e+1+" "+r(o)}`));return localStorage.removeItem(`${t+" "+r(o)}`),!0}A.addEventListener("click",()=>{E(-1),v(),d()});C.addEventListener("click",()=>{E(1),v(),d()});q.addEventListener("click",O);function O(){m.classList.contains("light-mode")?m.classList.remove("light-mode"):m.classList.add("light-mode")}
